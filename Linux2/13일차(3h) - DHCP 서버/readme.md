# DHCP의 개념
- 앞에서 컴퓨터를 잘 아는 사용자 때문에 IP 주소 할당에 문제가 발생하는 경우를 얘기했다. 이를 해결할 수 있는 서버가 DHCP(Dynamic Host Connguration Protocol) 서버다. 그러면 DHCP 서버를 운영할 때의 장점을 파악해보자.

- DHCP 서버가 하는 역할은 자신의 네트워크 안에 있는 클라이언트 컴퓨터가 부팅될 때 자동으로 IP 주소, 서브넷 마스크, 게이트웨이 주소, DNS 서버 주소를 할당해주는 것이다. 그러면 클라이언트 컴퓨터를 사용하는 일반 사용자는 인터넷을 하기 위한 IP 주소와 관련된 정보를 알지 못해도, 인터넷을 사용하는 데 아무런 문제가 없을 것이다. 한마디로 IP 주소가 무슨 말인지 몰라도 인터넷은 자신이 원하는 대로 아무 문제 없이 사용할 수 있다.

- 이와 같이 DHCP 서버의 가장 큰 장점은 관리의 편의성과 이용자의 편의성이라고 할 수 있다. 또, 한정된 IP 주소로 더 많은 IP 주소가 있는 것처럼 활용할 수도 있다. 예를 들어 어느 회사에서 대부분의 직원이 노트북을 사용하고 잦은 출장으로 자리를 비울 때가 많다면, 모든 사용자에게 고정 IP 주소를 주었을 경우 해당 IP 주소를 사용하지 않는 시간이 더 많을 것이다. 이때 DHCP 서버를 운영한다면 필요할 때마다 IP 주소를 할당하게 되므로, 해당 컴퓨터를 사용하지 않을 때 IP 주소를 다른 곳에 활용할 수 있다. 즉 적은 개수의 IP 주소가 있어도 여러 명의 사용자가 필요할 때마다 사용할 수 있다는 의미다. 이는 사설 IP 주소인 경우보다 공인 IP 주소인 경우 훨씬 유용하다.

#### 공인 IP와 사설 IP, 고정 IP와 동적 IP

- 공인 IP와 사설 IP, 고정 IP와 동적 IP의 개념을 명확히 구분하고 넘어가자.

- 공인 IP는 인터넷상에서 공인된 IP 주소다. 즉, 전 세계에 1개밖에 없는 IP 주소다. 예를 들어 실습에서 자주 사용하는 공인된 DNS 서버인 8.8.8.8은 전 세계 어디서든 접근할 수 있는 공인 IP 주소다.
- 사설 IP는 내부 네트워크 안에서만 통용되는 IP 주소다. 예를 들어 VMware 안에 설치된 가상머신들은 모두 사설네트워크 안에 위치한 컴퓨터이므로 사설 IP 주소다(여러분이 지금까지 보아왔던 192.168.xxx.000는 사설 IP 중에서 가장 많이 사용하는 주소 영역이다). 이는 내부 네트워크에서만 통용될 뿐 외부 인터넷에서는 인식하지 못하는 IP 주소다. 그래서 원칙적으로 사설 IP 주소를 사용하는 컴퓨터는 외부 인터넷에 접속할 수 없다. 
- 고정 IP는 컴퓨터 네트워크 정보에 직접 입력해주는 고정된 IP 주소를 말한다. 고정 IP 주소를 알려면 당연히네트워크 관리자에게 문의해야 한다. 고정 IP 주소를 입력한 컴퓨터는 재부팅해도 IP 주소가 변경되지 않는다.동적 IP(또는 유동 IP)는 컴퓨터를 부팅할 때마다 DHCP 서버로부터 얻어오는 IP 주소를 말한다. 그러므로컴퓨터를 부팅할 때마다 IP 주소가 변경될 수 있다.

- 또한 네 개의 용어가 공인 고정 IP, 공인 동적 IP 시설 고정 IP 시설 동적 IP로 섞여서 표현될 수도 있다. 공인고정 IP는 공인된 IP며 고정 IP로 사용되는 것을 말한다. 실습에서 종종 사용하는 주소인 8.8.8.8은 공인고정 IP로 사용하는 것이다. 공인 동적 IP(=공인 유동IP)는 공인 IP이면서, DHCP 서버에게 동적으로 할당받는 IP 주소다. 대표적인 예로 KT, SKT, LG-U+ 등에서 제공하는 초고속 통신망 서비스가 공인 동적 IP의예다. 즉, 초고속통신 서비스를 받는 컴퓨터를 켤 때 할당받는 IP 주소는 켤 때마다 바뀔 수 있지만, 전 세계에서 유일한 공인 IP를 할당받는 것이다.

- 사설 고정 IP는 사설 IP면서도 고정으로 사용되는 IP다. 실습에서 사용되는 Server. Server(B)는 사설 고정IP를 사용한다. 즉 10.0.2.100과 10.0.2.200은 사설 IP지만 고정적으로 할당해놓은 것이다. 사설동적 IP(=사설 유동IP)는 사설 IP를 동적으로 할당받는다는 의미다. 대부분의 DHCP 서버는 이러한 사설 동적 IP를 할당하려고 구성한다(이 책에서 사용하는 Client나 WinClient에 해당된다). 잠시 후 실습에서 구현하는 DHCP 서버도 사설 동적 IP(=사설 유동IP)를 할당하는 데 사용될 것이다.

-  간단히 DHCP 서버의 작동 원리를 파악해보자.

![image1](https://raw.githubusercontent.com/yonggyo1125/curriculumLinux/master/Linux2/13%EC%9D%BC%EC%B0%A8(3h)%20-%20DHCP%20%EC%84%9C%EB%B2%84/images/image1.png)

- 위 그림은 DHCP 서버의 작동 순서를 표현한다. 그림에 있는 ①~⑧을 살펴보면 어렵지 않게 DHCP 서버의 작동 방식을 알 수 있을 것이다. 여기서 주목할 점은 PC(DHCP 클라이언트)의 경우 ①번과 ⑧번 컴퓨터의 전원을 켜고 끄기만 하면 나머지는 자동으로 작동한다는 점이다. 즉 사용자는 더 이상 IP 주소와 관련된 정보에 신경쓸 필요가 없으며, 컴퓨터를 켜고 인터넷만 사용하면 된다.

- 여기서 궁금할 만한 사항은 PC는 아직 DHCP 서버의 주소를 모르는데 어떻게 ②번의 IP 주소 요청이 가능하냐는 점이다. DHCP 클라이언트로 설정된 PC는 전원이 켜지면 자신의 네트워크 케이블에 연결된 모든 컴퓨터에 ②번의 IP 주소 요청을 방송 Broadcast한다. 그러면 네트워크에 연결된 컴퓨터 중에서 다른 컴퓨터는 PC의 요청을 무시하고 DHCP 서버만 ④번의 응답을 하게 된다.

- DHCP 서버를 구현했다고 가정한다면, DHCP 클라이언트를 구현할 때는 별도로 설치할 프로그램이 없다. 윈도우에서 DHCP 클라이언트가 되려면, 다음처럼 [Internet Protocol Version4(TCP/IPv4) 속성]에서 [자동으로 IP 주소 받기]와 [자동으로 DNS 서버 주소 받기]를 선택한다.


- 리눅스에서 DHCP 클라이언트를 설정하려면 X 윈도가 설치된 환경에서 <b>nm-connection-editor</b>명령을 실행해 [네트워크 설정]을 열고 다음처럼 [IPv4 설정]을 '자동(DHCP)'으로 선택한다.


- CentOS를 텍스트 모드에서 DHCP 클라이언트로 설정하려면 /etc/sysconfig/networkscripts/ifcfg-enp0s3 파일의 BOOTPROTO 부분을 BOOTPROTO=dhcp로 수정한다.

> DHCP의 최신 내용을 살펴보거나 소스 파일을 다운로드하려면 https://www.isc.org/software/dhcp 에 접속하자.

* * * 
# DHCP 구현

DHCP 서버를 VMware에서 구현해보자. 우선 이 책에서 구현할 DHCP 서버인 다음 그림을 확인해본다.

다음 그림은 기존에 실습하던 환경과 거의 비슷한 환경이다. 실무 환경에서도 가상 컴퓨터와 가상 허브 Hub 대신 진짜 컴퓨터와 진짜 허브를 사용하는 것 외에는 다음 그림과 같은 환경과 차이가 없을 것이다.

![image2](https://raw.githubusercontent.com/yonggyo1125/curriculumLinux/master/Linux2/13%EC%9D%BC%EC%B0%A8(3h)%20-%20DHCP%20%EC%84%9C%EB%B2%84/images/image2.png)

