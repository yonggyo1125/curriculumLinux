# 네트워크 관련 설정과 명령어

## 네트워크 관련 필수 개념

- 네트워크와 관련된 내용은 상당히 방대하다. 모든 것을 이야기하기에는 적절하지 않으므로, 더 깊은 네트워크 지식은 다른 책이나 인터넷을 통해 학습하자. 여기에서는 후반부의 네트워크서버 구축을 위한 최소한의 네트워크 관련 개념과 명령어 위주로 살펴본다. 그래도 처음 네트워크를 접한다면 좀 어렵게 느껴질 수 있으므로, 모두 외우지는 않더라도 계속 실습에서 나오는 개념만큼은 확실히 파악하자.

### TCP/IP
- 컴퓨터끼리 네트워크상으로 의사소통하는 약속을 '프로토콜'이라고 부르는데, 그중 가장 널리 사용되는 프로토콜의 종류 중 하나다.

-  통신의 전송/수신을 다루는 TCP(Transmission Control Protocol)와 데이터 통신을 다루는 IP(Internet Protocol)로 구성된다.

### 호스트 이름과 도메인 이름

- 호스트 이름(host name)은 각각의 컴퓨터에 지정된 이름을 말한다.
- 도메인 이름(또는 도메인 주소) domain name은 hanbit.co.kr과 같은 형식으로 표기하며 kr은 한국, co는 회사, hanbit은 단체/회사 이름을 의미한다.
- 예) 호스트 이름이 this이고 도메인 이름이 hanbit.co.kr이라면 전체 이름은 this.hanbit.co.kr로 붙여서 부른다. 이를 FQDN(Fully Qualified Domain Name)이라고 한다. 즉 같은 회사(도메인)에서 this.hanbit.co.kr이라는 호스트(=컴퓨터)는 중복되지 않는다.

### IP 주소

- 각 컴퓨터의 랜 카드(Lan Card) (네트워크 카드(NIC. Nerwork Interface Card))에 부여되며 중복되지 않는 유일한 주소다.
- 즉 네트워크에 연결된 모든 컴퓨터는 고유한 IP 주소가 있으며, 이는 서로 다르기 때문에 특정 컴퓨터의 IP 주소를 알면 그 컴퓨터가 전 세계 어디에 있든지 접속할 수 있다는 개념이다(사설 IP 주소는 예외). 
- 4바이트로 이루어져 있으며 각 자리는 0\~255까지의 숫자가 올 수 있다. 예를 들어 Server의 IP 주소는 10.0.2.100이고, 모든 컴퓨터에서 자기 자신을 의미하는 IP 주소는 127.0.0.1이다.

### 네트워크 주소

- 같은 네트워크에 속해 있는 공통 주소다.

- 예를 들어 Server의 IP 주소는 10.0.2,100, Server(B)는 10.0.2.200, Client는 10․0․2.131(수강생 마다 다를 수 있음), 호스트 컴퓨터는 10.0.2.1이다. 이 네 대의 컴퓨터는 같은 네트워크에 있으며 서브넷 마스크는 C클래스(255.255.255.0)를 사용하므로 공통된 네트워크 주소는 앞 3자리인 10.0.2.0이 된다.

### 사설 네트워크

10.02.xxx.000의 주소 영역은 사설 네트워크(Private network)의 주소다. 사설 네트워크는 외부와 분리된 내부의 별도 네트워크를 의미하며, 주로 공인된 IP 주소가 부족할 때 많이 사용한다. 우리가 VirtualBox 설치한 컴퓨터들도 사설 네트워크의 IP 주소인 10.0.2,000를 할당한 것이다. 사설 네트워크 구축은 뒤에서 실습해본다.

### 브로드캐스트 주소

- 내부 네트워크의 모든 컴퓨터가 수신하는 주소를 말한다.
- 현재 주소의 제일 끝자리를 255로 바꾼 주소다(C클래스의 경우).
- 예를 들어 실습환경의 broadcast 주소는 10.0.2.255다.

> 브로드캐스트 주소를 좀 더 쉽게 비유하자면, 아파트의 스피커 또는 마을의 확성기 정도로 생각할 수 있다. 예를 들어 아파트 경비실에서 "차량 번호 7777 차를 다른 곳으로 이동시켜주세요"라고 말한다면 아파트 집집마다 스피커를 통해 전달된다. 하지만 모두가 다 응답하는 것은 아니다. 자신과 관련된 것이라면 반응을 보이겠지만, 자신과 관련이 없다면 그냥 무시하고 지나칠 것이다. 브로드캐스트 주소도 이런 아파트의 스피커처럼 모든 컴퓨터가 들을 수 있는 주소라고 생각하면 쉽게 이해할 수 있다.

### 게이트웨이(Gateway)

- 내부 네트워크를 외부로 연결하기 위한 컴퓨터 또는 장비다.
- Server, Server(B), Client 등 내부 네트워크에 있는 컴퓨터끼리 통신할 경우 외부로 나갈 필요가 없으므로 게이트웨이가 없어도 되지만, 인터넷을 사용하기 위해 외부에 접속하려면 반드시 게이트웨이의 IP 주소를 알아야 한다. 게이트웨이는 쉽게 말해 '외부 네트워크로 나가기 위한 통로'쯤으로 생각하면 된다. 그러므로 게이트웨이에는 내부로 향하는 문(네트워크 카드)과 외부로 향하는 문(네트워크 카드)이 있어야 한다. 즉, 두 개의 네트워크 카드가 장착되어 있어야 한다.
- 우리의 경우 게이트웨이 주소는 10.0.2.2로 고정되어 있다. 
- 게이트웨이를 별도로 추가하는 명령어 형식은 다음과 같다.

```
# route add default gw 게이트웨이 주소 dev 장치이름
```

- 예를 들어, 게이트웨이가 10.0.2.254로 변경되었을 때는 다음과 같이 사용한다.

```
# route add default gw 10.0.2.254 dev enp0s3
```

### 넷마스크와 클래스

- 넷마스크(Netmask): 네트워크의 규모를 결정한다.
- 강의에서는 사설 네트워크에서 C 클래스(class)를 사용하므로 넷마스크를 255.255.255.0으로 한다. 
- 설정한 환경에서는 10.0.2.0~10,0.2.255까지 256개의 IP 주소를 사용할 수 있지만, 그중에서 네트워크 주소인 10.0.2.0, 브로드캐스트 주소인 10.0.2.255, 게이트웨이로 사용할 IP 주소(10.0.2.2)를 제외하면 총 253대의 컴퓨터를 네트워크 내부에서 연결할 수 있다.


### 네트워크 클래스

- 만약 우리의 사설 네트워크에 253대가 넘는 컴퓨터를 설치하고자 한다면 넷마스크를 255.255.0.0으로 변경해 B 클래스로 사용하면 된다. 그러면 총 65536(2^16)개의 IP 주소를 사용할 수 있으며, 네트워크 주소는 10.0.0.0이 된다. 또 A 클래스로 변경하려면 255.0.0.0을 사용하면 된다.

### DNS 서버 주소

- 인터넷 사용 시 www.daum.net과 같은 URL을 해당 컴퓨터의 IP 주소로 변환해주는 서버 컴퓨터를 말한다.

- DNS(Domain Name System) 서버 (=네임 서버)의 주소를 사용하지 않거나 잘못 입력되어 있으면 웹 사이트에 정상적으로 접속되지 않으므로 올바른 정보를 설정해야 한다.

- 설정 파일은 "/etc/resolv.conf" 며, 내용 중에 'nameserver DNS서버IP' 형식으로 설정되어 있다.

### 리눅스에서의 네트워크 장치 이름

- 랜카드(NIC)가 리눅스에 장착되었을 때 CentOS 8을 설치하면 자동으로 이 장치의 이름을 enp0s3으로 인식한다.

- 이 랜카드의 이름은 앞으로 네트워크 정보를 파악하거나 네트워크를 정지 또는 가동할 때 자주 사용한다. 예를 들어 다음과 같은 명령을 종종 사용하게 될 것이다.

```
ifconfig enp0s3    -> 네트워크 설정 정보 출력
ifup enp0s3        -> 네트워크 장치 가동
ifdown enp0s3    -> 네트워크 장치 정지
```

- 만약 ifup, ifdown 명령어가 없다면 다음과 같이 설치한다.

```
dnf -y install NetworkManager-initscripts-up-down
```

## 중요한 네트워크 관련 명령어

- 네트워크와 관련된 명령어는 많지만, 이 책에서 주로 사용할 명령어는 몇 개 되지 않는다. 실습에서도 살펴보겠지만 이 정도는 꼭 외우도록 하자.

### nmtui

Network Manager Text User Interface의 약자로, 네트워크와 관련된 작업 대부분은 이 명령을 기반으로 실행할 수 있다

- 자동 IP 주소 또는 고정 IP 주소 사용 결정
- IP 주소, 서브넷 마스크, 게이트웨이 정보 입력
- DNS 정보 입력
- 네트워크 카드 드라이버 설정
- 네트워크 장치 (enp0s3) 설정

#### nmtui 명령과 ifcfg-enp0s3 파일

- nmtui 명령은 그놈(GNOME) 그래픽 모드를 제공하지 않는다. X 윈도의 그래픽 모드를 완전하게 사용해서 네트워크를 설정하려면 <b>gnome-control-center network</b> 명령 또는 <b>nm-connection-editor</b> 명령을 사용한다. 
- 하지만 이 명령어들은 Server(B)와 같은 텍스트 모드에서 사용할 수 없으므로 독자는 되도록 nmtui를 사용거나 직접 ifcfg-enp0s3 파일을 편집해서 네트워크를 설정하는 것을 권장한다.


### systemctl start/stop/restart/status NetworkManager

- 네트워크 설정을 변경한 후 변경된 내용을 시스템에 적용시키는 명령어다. 
- 그러므로 <b>nmtui</b> 명령을 실행한 후 또는 직접 <b>ifcfg-enp0s3</b> 파일을 편집한 후에는 꼭 <b>systemctl restart NetworkManager</b> 명령을실행 해야 한다고 기억하면 된다. 
- restart 옵션은 stop 옵션과 start 옵션이 합쳐진 것이다. status 옵션은 현재의 작동(active) 또는 정지(inactive) 상태를 표시한다.

### ifup 장치이름

- 해당 장치를 작동시키는 명령어다. 만약 네트워크 장치가 장착되었으나 작동하지 않는다면 이 명령어로네트워크 장치를 작동시킬 수 있다. 장치 이름에는 주로 enp0s3 이 사용된다.

### ifdown 장치이름

- ifup과 반대로 네트워크 장치를 끄는 명령어다.

### ifconfig 장치이름

- 해당 장치의 IP 주소와 관련 정보를 출력하는 명령어다.


### nslookup

- DNS 서버의 작동을 테스트하는 명령어다.


### ping IP 주소 또는 URL

- 해당 컴퓨터가 네트워크상에서 응답하는지 테스트하는 간편한 명령어다. 
- 즉, 상대 컴퓨터가 아무런 이상 없이 작동되는지를 네트워크상에서 체크할 때 주로 사용된다.


## 네트워크 설정과 관련된 주요 파일

- nmtui 명령을 실행하고 나서 변경되는 관련 파일들이다. 중요한 파일들이므로 꼭 알아두자.

### /etc/sysconfig/network

- 네트워크의 기본 정보가 설정되어 있는 파일이며 네트워크 사용 여부가 써 있다.


### /etc/sysconfig/network-scripts/ifcfg-enp0s3

- enp0s3 장치에 설정된 네트워크 정보가 모두 들어 있는 파일이다.

### /etc/resolv.conf

- DNS 서버의 정보와 호스트 이름이 들어 있는 파일이다.

### /etc/hosts

- 현재 컴퓨터의 호스트 이름과 FQDN이 들어 있는 파일이다.

> nmtui 명령을 사용하지 않아도 위 4개의 파일을 직접 편집하면 동일한 효과를 낼 수 있다.

## 실습1

nmtui 명령어 및 이와 관련된 설정 파일을 확인해보자.

#### step0

- Server를 처음 설치 상태로 초기화하자
- root 사용자로 접속한다. 
- 바탕 화면 왼쪽 위의 [현재 활동] →[터미널]을 선택해서 터미널을 연다.

#### step1

- <b>nmtui</b> 명령을 입력해서 IP 정보 등을 확인해보자.
- 다음을 참고하여 설정했던 네트워크 정보를 확인해보자 (이제부터는 키보드의 [Tab] 또는 화살표키, [Enter]를 사용해야 한다)

